<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="../../../index.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"          
                xmlns:f="http://xmlns.jcp.org/jsf/core"                    
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"

                xmlns:p="http://xmlns.jcp.org/jsf/passthrough">
    <ui:define name="page_content">
        <c:if test="#{sesionUsuario.usuarioLogueado.empresaUsuario.id != editarAccion.accionSeleccionada.empresaAccion.id}">
            <meta http-equiv="refresh" content="0;url=#{facesContext.externalContext.requestContextPath}/Views/Errores/Error_500.xhtml"></meta>
        </c:if>
        <c:if test="#{sesionUsuario.usuarioLogueado.empresaUsuario.id == editarAccion.accionSeleccionada.empresaAccion.id}">
            <c:if test="#{sesionUsuario.usuarioLogueado.permisoUsuario != 'LECTURA'}">
                <div class="container-fluid" style="padding: 1%">
                    <h:form id="form_segumiento_accion" enctype="multipart/form-data">
                        <div class="row">                    
                            <div class="col-sm-12">
                                <!-- Estado -->
                                <div class="panel panel-default">
                                    <div class="panel-heading" >Estado:</div>
                                    <div class="panel-body estado-#{seguimientoAccion.accionSeleccionada.estadoDeAccion}">
                                        #{seguimientoAccion.accionSeleccionada.estadoDeAccion.descripcion}
                                    </div>                                        
                                </div>
                            </div>
                        </div>
                        <!-- Descripcion -->
                        <div class="panel panel-default">
                            <div class="panel-heading">Descripcion</div>
                            <div class="panel-body">
                                <div class="row">                            
                                    <div class="col-sm-3">
                                        <div class="form-group">
                                            <strong><label for="fecha_deteccion">Fecha de Deteccion</label></strong>
                                            <h:outputText id="fecha_deteccion" class="form-control" value="#{seguimientoAccion.accionSeleccionada.strFechaDeteccion}" />   
                                        </div>                    
                                    </div>
                                    <div class="col-sm-3">
                                        <div class="form-group">
                                            <strong><label for="area_deteccion">Area / Sector:</label></strong>
                                            <h:outputText id="area_deteccion" class="form-control" value="#{seguimientoAccion.accionSeleccionada.areaAccion.nombre}" />         
                                        </div>
                                    </div>
                                    <div class="col-sm-3">
                                        <div class="form-group">
                                            <strong><label id="tipo_deteccion">Tipo de Deteccion:</label></strong>
                                            <h:outputText id="tipo_deteccion" class="form-control" value="#{seguimientoAccion.accionSeleccionada.deteccionAccion.tipoDeDeteccion}" />         
                                        </div>
                                    </div>
                                    <div class="col-sm-3">
                                        <div class="form-group">
                                            <strong><label id="deteccion">Generada por:</label></strong>
                                            <h:outputText id="deteccion" class="form-control" value="#{seguimientoAccion.accionSeleccionada.deteccionAccion.nombre}" />         
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="form-group">
                                        <strong><label for="descripcion_correctiva">Descripcion de la Accion Correctiva</label></strong>
                                        <h:inputTextarea id="descripcion_correctiva" class="form-control" readonly="true" style="background-color: rgb(255,255,255)" 
                                                         rows="4" value="#{seguimientoAccion.accionSeleccionada.descripcion}" />
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div class="form-group">
                                        <strong><label for="analisis_causa">Analisis de Causa</label></strong>
                                        <h:inputTextarea id="analisis_causa" class="form-control" readonly="true" style="background-color: rgb(255,255,255)"  
                                                         rows="4" value="#{seguimientoAccion.accionSeleccionada.analisisCausa}" />
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="form-group">
                                            <strong><label for="codificacion_correctiva">Codificacion</label></strong>
                                            <h:outputText id="codificacion_correctiva" class="form-control" value="#{seguimientoAccion.accionSeleccionada.codificacionAccion.nombre}" />
                                        </div>
                                    </div>
                                </div>                            
                            </div>
                        </div>
                        <c:choose>
                            <c:when test="#{seguimientoAccion.tipoDeAccion == 'CORRECTIVA'}">
                                <h:panelGroup id="panel_medidas_correctivas">
                                    <div class="panel panel-primary">
                                        <div class="panel-heading" >Medidas Correctivas</div>
                                        <div class="panel-body">
                                            <c:choose>
                                                <c:when test="#{not empty seguimientoAccion.medidasCorrectivas}">
                                                    <div class="table-responsive-sm">
                                                        <table class="table table-hover table-striped">
                                                            <thead>
                                                                <tr>
                                                                    <th>Descripcion:</th>
                                                                    <th>Fecha Estimada:</th>
                                                                    <th>Responsable Implementacion:</th>
                                                                    <th>Implementacion:</th>
                                                                    <c:if test="#{sesionUsuario.usuarioLogueado.permisoUsuario != 'LECTURA'}">
                                                                        <th></th>
                                                                    </c:if>

                                                                </tr>                                                
                                                            </thead>
                                                            <tbody>
                                                                <c:forEach items="#{seguimientoAccion.medidasCorrectivas}" var="correctiva" >
                                                                    <tr>
                                                                        <td>#{correctiva.descripcion}</td>
                                                                        <td>#{correctiva.strFechaEstimadaImplementacion}</td>
                                                                        <td>#{correctiva.responsableImplementacion.responsabilidadResponsable.nombre} #{correctiva.responsableImplementacion.usuarioResponsable.nombreCompleto}</td>
                                                                        <td>
                                                                            <c:if test="#{correctiva.fechaImplementacion == null}" >
                                                                                Sin Implementar
                                                                            </c:if>
                                                                            <c:if test="#{correctiva.fechaImplementacion != null}" >
                                                                                #{correctiva.strFechaImplementacion}
                                                                            </c:if>
                                                                        </td>
                                                                        <c:if test="#{sesionUsuario.usuarioLogueado.permisoUsuario != 'LECTURA' and correctiva.fechaImplementacion == null}">
                                                                            <td>
                                                                                <c:choose>
                                                                                    <c:when test="#{correctiva.responsableImplementacion.usuarioResponsable.id != sesionUsuario.usuarioLogueado.id}">
                                                                                        <div class="btn-group">                                                    
                                                                                            <h:commandButton class="btn btn-primary disabled" value="Comprobar" title="Solo lo puede comprobar el usuario responsable." />
                                                                                        </div>
                                                                                    </c:when>
                                                                                    <c:otherwise>
                                                                                        <div class="btn-group">
                                                                                            <h:inputText id="fecha_implementacion_actividad_#{correctiva.id}" class="form-control calendario" value="#{seguimientoAccion.strFechaImplementacion}" />
                                                                                            <h:commandButton id="btn_setFechaImplementacion_corr_#{correctiva.id}" action="#{seguimientoAccion.setFechaImplementacionActividad(correctiva.id, 'CORRECTIVA')}" 
                                                                                                             class="btn btn-primary"  value="Registrar" >                                                                                                     
                                                                                                <f:ajax execute="fecha_implementacion_actividad_#{correctiva.id}" render="panel_medidas_correctivas" />
                                                                                            </h:commandButton>                                                            
                                                                                        </div>
                                                                                    </c:otherwise>
                                                                                </c:choose>
                                                                            </td> 
                                                                        </c:if>
                                                                    </tr>   
                                                                    <h:panelGroup >
                                                                        <div class="form-group-sm">
                                                                            <h:message for="btn_setFechaImplementacion_corr_#{correctiva.id}" class="msj_error"/>
                                                                        </div>
                                                                    </h:panelGroup>
                                                                </c:forEach>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </c:when>
                                                <c:otherwise>
                                                    <div class="alert alert-info">
                                                        <strong>Info!</strong> No se definieron medidas correctivas.
                                                    </div>
                                                </c:otherwise>
                                            </c:choose>                            
                                        </div>
                                    </div>
                                </h:panelGroup>
                                <h:panelGroup id="panel_medidas_preventivas">
                                    <div class="panel panel-primary">
                                        <div class="panel-heading" >Medidas Preventivas</div>
                                        <div class="panel-body">
                                            <c:choose>
                                                <c:when test="#{not empty seguimientoAccion.medidasPreventivas}">
                                                    <div class="table-responsive-sm">
                                                        <table class="table table-hover table-striped">
                                                            <thead>
                                                                <tr>
                                                                    <th>Descripcion:</th>
                                                                    <th>Fecha Estimada:</th>
                                                                    <th>Responsable Implementacion:</th>
                                                                    <th>Implementacion:</th>
                                                                    <c:if test="#{sesionUsuario.usuarioLogueado.permisoUsuario != 'LECTURA'}">
                                                                        <th></th>
                                                                    </c:if>

                                                                </tr>                                                
                                                            </thead>
                                                            <tbody>
                                                                <c:forEach items="#{seguimientoAccion.medidasPreventivas}" var="preventiva" >
                                                                    <tr>
                                                                        <td>#{preventiva.descripcion}</td>
                                                                        <td>#{preventiva.strFechaEstimadaImplementacion}</td>
                                                                        <td>#{preventiva.responsableImplementacion.responsabilidadResponsable.nombre} #{preventiva.responsableImplementacion.usuarioResponsable.nombreCompleto}</td>
                                                                        <td>
                                                                            <c:if test="#{preventiva.fechaImplementacion == null}" >
                                                                                Sin Implementar
                                                                            </c:if>
                                                                            <c:if test="#{preventiva.fechaImplementacion != null}" >
                                                                                #{preventiva.strFechaImplementacion}
                                                                            </c:if>
                                                                        </td>
                                                                        <c:if test="#{sesionUsuario.usuarioLogueado.permisoUsuario != 'LECTURA' and preventiva.fechaImplementacion == null}">
                                                                            <td>
                                                                                <c:choose>
                                                                                    <c:when test="#{preventiva.responsableImplementacion.usuarioResponsable.id != sesionUsuario.usuarioLogueado.id}">
                                                                                        <div class="btn-group">                                                    
                                                                                            <h:commandButton class="btn btn-primary disabled" title="Solo lo puede comprobar el usuario responsable." value="Comprobar" />        
                                                                                        </div>
                                                                                    </c:when>
                                                                                    <c:otherwise>
                                                                                        <div class="btn-group">
                                                                                            <h:inputText id="fecha_implementacion_actividad_#{preventiva.id}" class="form-control calendario" value="#{seguimientoAccion.strFechaImplementacion}" />
                                                                                            <h:commandButton id="btn_setFechaImplementacion_#{preventiva.id}" action="#{seguimientoAccion.setFechaImplementacionActividad(preventiva.id, 'PREVENTIVA')}" 
                                                                                                             class="btn btn-primary" value="Registrar" >                                                                                                     
                                                                                                <f:ajax execute="fecha_implementacion_actividad_#{preventiva.id}" render="panel_medidas_preventivas" />
                                                                                            </h:commandButton>                                                            
                                                                                        </div>
                                                                                    </c:otherwise>
                                                                                </c:choose>   
                                                                            </td> 
                                                                        </c:if>
                                                                    </tr> 
                                                                    <h:panelGroup >
                                                                        <div class="form-group-sm">
                                                                            <h:message for="btn_setFechaImplementacion_prev_#{preventiva.id}" class="msj_error"/>
                                                                        </div>
                                                                    </h:panelGroup>
                                                                </c:forEach>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </c:when>
                                                <c:otherwise>
                                                    <div class="alert alert-info">
                                                        <strong>Info!</strong> No se definieron medidas preventivas.
                                                    </div>
                                                </c:otherwise>
                                            </c:choose>                            
                                        </div>
                                    </div>
                                </h:panelGroup>
                            </c:when>
                            <c:otherwise>
                                <h:panelGroup id="panel_actividades">
                                    <div class="panel panel-primary">
                                        <div class="panel-heading" >Actividades:</div>
                                        <div class="panel-body">
                                            <c:choose>
                                                <c:when test="#{not empty seguimientoAccion.actividades}">
                                                    <div class="table-responsive-sm">
                                                        <table class="table table-hover table-striped">
                                                            <thead>
                                                                <tr>
                                                                    <th>Descripcion:</th>
                                                                    <th>Fecha Estimada:</th>
                                                                    <th>Responsable Implementacion:</th>
                                                                    <th>Implementacion:</th>
                                                                    <c:if test="#{sesionUsuario.usuarioLogueado.permisoUsuario != 'LECTURA'}">
                                                                        <th></th>
                                                                    </c:if>

                                                                </tr>                                                
                                                            </thead>
                                                            <tbody>
                                                                <c:forEach items="#{seguimientoAccion.actividades}" var="actividad" >
                                                                    <tr>
                                                                        <td>#{actividad.descripcion}</td>
                                                                        <td>#{actividad.strFechaEstimadaImplementacion}</td>
                                                                        <td>#{actividad.responsableImplementacion.responsabilidadResponsable.nombre} #{actividad.responsableImplementacion.usuarioResponsable.nombreCompleto}</td>
                                                                        <td>
                                                                            <c:if test="#{actividad.fechaImplementacion == null}" >
                                                                                Sin Implementar
                                                                            </c:if>
                                                                            <c:if test="#{actividad.fechaImplementacion != null}" >
                                                                                #{actividad.strFechaImplementacion}
                                                                            </c:if>
                                                                        </td>
                                                                        <c:if test="#{sesionUsuario.usuarioLogueado.permisoUsuario != 'LECTURA' and actividad.fechaImplementacion == null}">
                                                                            <td>
                                                                                <c:choose>                                                                                
                                                                                    <c:when test="#{actividad.responsableImplementacion.usuarioResponsable.id != sesionUsuario.usuarioLogueado.id}">
                                                                                        <div class="btn-group">                                                    
                                                                                            <h:commandButton class="btn btn-primary disabled" title="Solo lo puede comprobar el usuario responsable." value="Comprobar" />        
                                                                                        </div>
                                                                                    </c:when>
                                                                                    <c:otherwise>
                                                                                        <div class="btn-group">
                                                                                            <h:inputText id="fecha_implementacion_actividad_#{actividad.id}" class="form-control calendario" value="#{seguimientoAccion.strFechaImplementacion}" />
                                                                                            <h:commandButton id="btn_setFechaImplementacion_act_#{actividad.id}" action="#{seguimientoAccion.setFechaImplementacionActividad(actividad.id, 'MEJORA')}" 
                                                                                                             class="btn btn-primary"  value="Registrar" >                                                                                                     
                                                                                                <f:ajax execute="fecha_implementacion_actividad_#{actividad.id}" render="panel_actividades" />
                                                                                            </h:commandButton>                                                            
                                                                                        </div>
                                                                                    </c:otherwise>
                                                                                </c:choose> 
                                                                            </td>
                                                                        </c:if>
                                                                    </tr> 
                                                                    <h:panelGroup >
                                                                        <div class="form-group-sm">
                                                                            <h:message for="btn_setFechaImplementacion_act_#{actividad.id}" class="msj_error"/>
                                                                        </div>
                                                                    </h:panelGroup>
                                                                </c:forEach>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </c:when>
                                                <c:otherwise>
                                                    <div class="alert alert-info">
                                                        <strong>Info!</strong> No se definieron actividades.
                                                    </div>
                                                </c:otherwise>
                                            </c:choose>                            
                                        </div>
                                    </div>
                                </h:panelGroup>
                            </c:otherwise>
                        </c:choose>

                        <div class="row">
                            <div class="col-sm-6">
                                <div class="panel panel-primary">
                                    <div class="panel-heading" >Comprobacion de Implementacion</div>
                                    <div class="panel-body">
                                        <h:panelGroup id="panel_comprobacion_implementacion">
                                            <c:choose>
                                                <!-- CASO 1: esta implementadas y no se ha comprobado la implementacion. -->
                                                <c:when test="#{seguimientoAccion.accionSeleccionada.comprobacionImplementacion.fechaComprobacion == null and
                                                                seguimientoAccion.estaImplementada == true}">
                                                    <c:choose>
                                                        <c:when test="#{seguimientoAccion.accionSeleccionada.comprobacionImplementacion.responsableComprobacion.usuarioResponsable.id != sesionUsuario.usuarioLogueado.id}">
                                                            <div class="alert alert-info">
                                                                <c:choose>
                                                                    <c:when test="#{seguimientoAccion.accionSeleccionada.comprobacionImplementacion.responsableComprobacion == null}" >
                                                                        <strong>Info!</strong> No se ha definido Responsable de Comprobacion.
                                                                    </c:when>
                                                                    <c:otherwise>
                                                                        <strong>Info!</strong> Responsable de Comprobacion: #{seguimientoAccion.accionSeleccionada.comprobacionImplementacion.responsableComprobacion.responsabilidadResponsable.nombre} #{seguimientoAccion.accionSeleccionada.comprobacionImplementacion.responsableComprobacion.usuarioResponsable.nombreCompleto}
                                                                    </c:otherwise>
                                                                </c:choose>                                                        
                                                            </div> 
                                                        </c:when>
                                                        <c:otherwise>
                                                            <div class="row">
                                                                <div class="col-sm-6">
                                                                    <div class="form-group">
                                                                        <strong><label for="fecha_comprobacion_implementacion">Fecha de Comprobacion</label></strong>
                                                                        <h:inputText id="fecha_comprobacion_implementacion" class="form-control calendario" value="#{seguimientoAccion.strFechaComprobacionImplementacion}" />
                                                                    </div>
                                                                </div>
                                                                <div class="col-sm-6">
                                                                    <div class="form-group">
                                                                        <strong><label for="resultado_comprobacion_implementacion">Resultado de la Comprobacion</label></strong>
                                                                        <h:selectOneRadio id="resultado_comprobacion_implementacion" value="#{seguimientoAccion.comprobacionSeleccionadaImplementacion}" >
                                                                            <c:forEach items="#{seguimientoAccion.comprobaciones}" var="tipo_comprobaciones">
                                                                                <div class="radio">
                                                                                    <f:selectItem itemLabel="#{tipo_comprobaciones.descripcion}" itemValue="#{tipo_comprobaciones}" />
                                                                                </div>
                                                                            </c:forEach>
                                                                        </h:selectOneRadio>
                                                                    </div>
                                                                </div>                                            
                                                            </div>
                                                            <div class="form-group" >
                                                                <strong><label for="observaciones_comprobacion_implementacion">Observaciones</label></strong>
                                                                <h:inputTextarea id="observaciones_comprobacion_implementacion" class="form-control" value="#{seguimientoAccion.observacionesImplementacion}" />
                                                            </div>
                                                            <h:panelGroup id="panel_mensajes_implementacion">
                                                                <div class="form-group-sm">
                                                                    <h:message for="fecha_comprobacion_implementacion" class="msj_error"/>
                                                                </div>                   
                                                                <div class="form-group-sm">
                                                                    <h:message for="observaciones_comprobacion_implementacion" class="msj_error"/>
                                                                </div>                    
                                                                <div class="form-group-sm">
                                                                    <h:message for="btn_comprobar_implementacion" class="msj_info"/>
                                                                </div>
                                                            </h:panelGroup>
                                                            <div class="btn-group">
                                                                <h:commandButton id="btn_comprobar_implementacion" action="#{seguimientoAccion.comprobarImplementacionAccion()}" class="btn btn-primary"  value="Comprobar Implementacion de Accion" >                                                                                                     
                                                                    <f:ajax execute="panel_comprobacion_implementacion"  render="panel_comprobacion_implementacion panel_comprobacion_eficacia panel_mensajes_implementacion" />
                                                                </h:commandButton>                                                            
                                                            </div>  
                                                        </c:otherwise>
                                                    </c:choose>                                            
                                                </c:when>
                                                <!-- CASO 2: NO esta implementada. -->
                                                <c:when test="#{seguimientoAccion.accionSeleccionada.comprobacionImplementacion.fechaComprobacion == null and
                                                                seguimientoAccion.estaImplementada == false}">
                                                    <div class="alert alert-info">
                                                        <strong>Info!</strong> No se han implementado todas las medidas definidas.
                                                    </div>
                                                </c:when>
                                                <!-- CASO 3: esta implementada y Se comprobo la implementacion. -->

                                                <c:when test="#{seguimientoAccion.accionSeleccionada.comprobacionImplementacion != null and
                                                                seguimientoAccion.estaImplementada == true}">
                                                    Se comprobo la implementacion el dia #{seguimientoAccion.strFechaComprobacionImplementacion} con resultado                                           
                                                    #{seguimientoAccion.comprobacionSeleccionadaImplementacion.descripcion}
                                                    <c:if test="#{seguimientoAccion.observacionesImplementacion.blank}">
                                                        Sin Observaciones.
                                                    </c:if>
                                                    <c:if test="#{not seguimientoAccion.observacionesImplementacion.blank}">
                                                        Observaciones: #{seguimientoAccion.observacionesImplementacion}   
                                                    </c:if>
                                                </c:when> 
                                            </c:choose>
                                        </h:panelGroup>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="panel panel-primary">
                                    <div class="panel-heading" >Comprobacion de Eficacia</div>
                                    <div class="panel-body">
                                        <h:panelGroup id="panel_comprobacion_eficacia">
                                            <c:choose>
                                                <!-- CASO 1: esta implementada, se comprobo la implementacion -->
                                                <c:when test="#{seguimientoAccion.accionSeleccionada.comprobacionEficacia.fechaComprobacion == null and 
                                                                seguimientoAccion.accionSeleccionada.comprobacionImplementacion.fechaComprobacion != null and
                                                                seguimientoAccion.estaImplementada == true}">
                                                    <c:choose>
                                                        <c:when test="#{seguimientoAccion.accionSeleccionada.comprobacionEficacia.responsableComprobacion.usuarioResponsable.id != sesionUsuario.usuarioLogueado.id}">
                                                            <div class="alert alert-info">
                                                                <c:choose>
                                                                    <c:when test="#{seguimientoAccion.accionSeleccionada.comprobacionEficacia.responsableComprobacion == null }">
                                                                        <strong>Info!</strong> No se ha definido Responsable de Verificacion.
                                                                    </c:when>
                                                                    <c:otherwise>
                                                                        <strong>Info!</strong> Responsable de Verificacion: #{seguimientoAccion.accionSeleccionada.comprobacionEficacia.responsableComprobacion.responsabilidadResponsable.nombre} #{seguimientoAccion.accionSeleccionada.comprobacionEficacia.responsableComprobacion.usuarioResponsable.nombreCompleto}
                                                                    </c:otherwise>
                                                                </c:choose>                                                        
                                                            </div>  
                                                        </c:when>
                                                        <c:otherwise>
                                                            <div class="row">
                                                                <div class="col-sm-6">
                                                                    <div class="form-group">
                                                                        <strong><label for="fecha_comprobacion_eficacia">Fecha de Comprobacion</label></strong>
                                                                        <h:inputText id="fecha_comprobacion_eficacia" class="form-control calendario" value="#{seguimientoAccion.strFechaComprobacionEficacia}" />
                                                                    </div>
                                                                </div>
                                                                <div class="col-sm-6">
                                                                    <div class="form-group">
                                                                        <strong><label for="resultado_comprobacion_eficacia">Resultado de la Comprobacion</label></strong>
                                                                        <h:selectOneRadio id="resultado_comprobacion_eficacia" value="#{seguimientoAccion.comprobacionSeleccionadaEficacia}" >
                                                                            <c:forEach items="#{seguimientoAccion.comprobaciones}" var="tipo_comprobaciones">
                                                                                <div class="radio">
                                                                                    <f:selectItem itemLabel="#{tipo_comprobaciones.descripcion}" itemValue="#{tipo_comprobaciones}" />
                                                                                </div>
                                                                            </c:forEach>
                                                                        </h:selectOneRadio>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="form-group" >
                                                                <strong><label for="observaciones_comprobacion_eficacia">Observaciones</label></strong>
                                                                <h:inputTextarea id="observaciones_comprobacion_eficacia" class="form-control" value="#{seguimientoAccion.observacionesEficacia}" />
                                                            </div>     
                                                            <h:panelGroup id="panel_mensajes_eficacia">
                                                                <div class="form-group-sm">
                                                                    <h:message for="fecha_comprobacion_eficacia" class="msj_error"/>
                                                                </div>                   
                                                                <div class="form-group-sm">
                                                                    <h:message for="observaciones_comprobacion_eficacia" class="msj_error"/>
                                                                </div>                    
                                                                <div class="form-group-sm">
                                                                    <h:message for="btn_comprobar_eficacia" class="msj_info"/>
                                                                </div>
                                                            </h:panelGroup>
                                                            <div class="btn-group" >                                                      
                                                                <h:commandButton id="btn_comprobar_eficacia" class="btn btn-primary"  value="Comprobar Eficacia de Accion" >                                                                                                     
                                                                    <f:ajax execute="panel_comprobacion_eficacia" event="click" listener="#{seguimientoAccion.comprobarEficaciaAccion()}" render="panel_comprobacion_implementacion panel_comprobacion_eficacia panel_mensajes_eficacia"  onevent="indicador" />
                                                                </h:commandButton>                                                            
                                                            </div>
                                                        </c:otherwise>
                                                    </c:choose>                                            
                                                </c:when>
                                                <!-- CASO 2: NO esta implementada, NO se comprobo la implementacion -->
                                                <c:when test="#{seguimientoAccion.accionSeleccionada.comprobacionEficacia.fechaComprobacion == null and 
                                                                seguimientoAccion.accionSeleccionada.comprobacionImplementacion.fechaComprobacion == null and
                                                                seguimientoAccion.estaImplementada == false}">
                                                    <div class="alert alert-info">
                                                        <strong>Info!</strong> No se han implementado todas las medidas definidas. No se ha comprobado la implementacion.
                                                    </div>                                       
                                                </c:when>
                                                <!-- CASO 3: esta implementada, NO se comprobo la implementacion -->
                                                <c:when test="#{seguimientoAccion.accionSeleccionada.comprobacionEficacia.fechaComprobacion == null and 
                                                                seguimientoAccion.accionSeleccionada.comprobacionImplementacion.fechaComprobacion == null and
                                                                seguimientoAccion.estaImplementada == true}">
                                                    <div class="alert alert-info">
                                                        <strong>Info!</strong> No se ha comprobado la implementacion de la accion.
                                                    </div>                                       
                                                </c:when>
                                                <!-- CASO 4: esta implementada, se comprobo la implementacion y la eficacia -->
                                                <c:when test="#{seguimientoAccion.accionSeleccionada.comprobacionEficacia.fechaComprobacion != null and 
                                                                seguimientoAccion.accionSeleccionada.comprobacionImplementacion.fechaComprobacion != null and
                                                                seguimientoAccion.estaImplementada == true}">
                                                    Se comprobo la implementacion el dia #{seguimientoAccion.strFechaComprobacionEficacia} con resultado
                                                    #{seguimientoAccion.comprobacionSeleccionadaEficacia.descripcion}
                                                    <c:if test="#{seguimientoAccion.observacionesEficacia.blank}">
                                                        Sin Observaciones
                                                    </c:if>
                                                    <c:if test="#{not seguimientoAccion.observacionesEficacia.blank}">
                                                        Observaciones: #{seguimientoAccion.observacionesEficacia}
                                                    </c:if>                                            
                                                </c:when>
                                            </c:choose>                                    
                                        </h:panelGroup>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- ADJUNTOS -->
                        <div class="panel panel-primary">
                            <div class="panel-heading" >Archivos Adjuntos / Anexos:</div>
                            <div class="panel-body">                        
                                <h:panelGroup id="panel_lista_adjuntos">
                                    <c:choose>
                                        <c:when test="#{empty seguimientoAccion.mapAdjuntos}">
                                            <div class="alert alert-info">
                                                <strong>Info!</strong> No se han cargado datos adjuntos.
                                            </div>
                                            <div class="form-group">
                                                <h:commandLink class="btn btn-primary" p:data-toggle="modal" p:data-target="#modal_nuevo_adjunto" >
                                                    <span class="glyphicon glyphicon-plus" style="font-family: sans-serif;"> Agregar Adjunto</span>
                                                    <f:ajax delay="100" render="form_segumiento_accion:modal_nuevo_adjunto" />
                                                </h:commandLink> 
                                            </div>
                                        </c:when>
                                        <c:otherwise>
                                            <div class="form-group">
                                                <h:commandLink class="btn btn-primary" p:data-toggle="modal" p:data-target="#modal_nuevo_adjunto" >
                                                    <span class="glyphicon glyphicon-plus" style="font-family: sans-serif;"> Agregar Adjunto</span>
                                                    <f:ajax delay="100" render="form_segumiento_accion:modal_nuevo_adjunto" />
                                                </h:commandLink> 
                                            </div>
                                            <div class="panel-group" id="accordion">
                                                <div class="panel panel-default">
                                                    <div class="panel-heading">
                                                        <h4 class="panel-title">
                                                            <c:if test="#{seguimientoAccion.totalImagenes == 0}">
                                                                Imágenes 
                                                                <span class="badge" style="background-color: #398439"> #{seguimientoAccion.totalImagenes}</span>
                                                            </c:if>
                                                            <c:if test="#{seguimientoAccion.totalImagenes > 0}">
                                                                <a data-toggle="collapse" data-parent="#accordion" href="#collapse1">Imágenes 
                                                                    <span class="badge" style="background-color: #398439"> #{seguimientoAccion.totalImagenes}</span>
                                                                </a>
                                                            </c:if>
                                                        </h4>
                                                    </div>
                                                    <div id="collapse1" class="panel-collapse collapse">
                                                        <div class="panel-body">                                               
                                                            <table class="table table-striped table-responsive-sm">
                                                                <thead>
                                                                    <tr>
                                                                        <th width="30%">Titulo</th>
                                                                        <th width="60%">Adjunto</th>
                                                                        <th width="20%"></th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody style="font-size: 11px">
                                                                    <c:forEach items="#{seguimientoAccion.mapAdjuntos}" var="adjunto">
                                                                        <c:if test="#{adjunto.value.tipoDeAdjunto =='IMAGEN'}">
                                                                            <tr>
                                                                                <td>
                                                                                    #{adjunto.value.titulo}
                                                                                </td>
                                                                                <td>
                                                                                    <a href="/datos#{adjunto.value.ubicacion}" target="blank"><img alt="#{adjunto.value.ubicacion}" src="/datos#{adjunto.value.ubicacion}" class="img-responsive img-thumbnail" width="10%"/></a>
                                                                                </td>
                                                                                <td>
                                                                                    <div class="btn-group">
                                                                                        <h:commandLink action="#{seguimientoAccion.quitarAdjunto(adjunto.key)}" class="btn btn-danger" value="Eliminar Adjunto" onclick="if (!confirm('Seguro que desea quitar este adjunto? Se eliminara inmediatamente de la accion.'))
                                                                                                    return false">
                                                                                            <span class="glyphicon glyphicon-trash"> </span>
                                                                                            <f:ajax render="panel_lista_adjuntos"  onevent="indicador"/>
                                                                                        </h:commandLink>
                                                                                    </div>
                                                                                </td>                                                                    
                                                                            </tr>
                                                                        </c:if>
                                                                    </c:forEach>
                                                                </tbody>                                            
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="panel panel-default">
                                                    <div class="panel-heading">
                                                        <h4 class="panel-title">
                                                            <c:if test="#{seguimientoAccion.totalVideos == 0}">
                                                                Videos 
                                                                <span class="badge" style="background-color: #398439"> #{seguimientoAccion.totalVideos}</span>
                                                            </c:if>
                                                            <c:if test="#{seguimientoAccion.totalVideos > 0}">
                                                                <a data-toggle="collapse" data-parent="#accordion" href="#collapse2">Videos 
                                                                    <span class="badge" style="background-color: #398439"> #{seguimientoAccion.totalVideos}</span>
                                                                </a>
                                                            </c:if>
                                                        </h4>
                                                    </div>
                                                    <div id="collapse2" class="panel-collapse collapse">
                                                        <div class="panel-body">                                               
                                                            <table class="table table-striped table-responsive-sm">
                                                                <thead>
                                                                    <tr>
                                                                        <th width="30%">Titulo</th>
                                                                        <th width="60%">Adjunto</th>
                                                                        <th width="20%"></th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody style="font-size: 11px">
                                                                    <c:forEach items="#{seguimientoAccion.mapAdjuntos}" var="adjunto">
                                                                        <c:if test="#{adjunto.value.tipoDeAdjunto =='VIDEO'}">
                                                                            <tr>
                                                                                <td>
                                                                                    #{adjunto.value.titulo}
                                                                                </td>
                                                                                <td>
                                                                                    <video controls="true" width="250">
                                                                                        <source src="/datos#{adjunto.value.ubicacion}" type="video/mp4" />
                                                                                    </video>
                                                                                </td>
                                                                                <td>
                                                                                    <div class="btn-group">
                                                                                        <h:commandLink action="#{seguimientoAccion.quitarAdjunto(adjunto.key)}" class="btn btn-danger" value="Eliminar Adjunto" onclick="if (!confirm('Seguro que desea quitar este adjunto? Se eliminara inmediatamente de la accion.'))
                                                                                                    return false">
                                                                                            <span class="glyphicon glyphicon-trash"> </span>
                                                                                            <f:ajax render="panel_lista_adjuntos"  onevent="indicador"/>
                                                                                        </h:commandLink>
                                                                                    </div>
                                                                                </td>                                                                    
                                                                            </tr>
                                                                        </c:if>
                                                                    </c:forEach>
                                                                </tbody>                                            
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="panel panel-default">
                                                    <div class="panel-heading">
                                                        <h4 class="panel-title">
                                                            <c:if test="#{seguimientoAccion.totalOtros == 0}">
                                                                Otros Archivos 
                                                                <span class="badge" style="background-color: #398439"> #{seguimientoAccion.totalOtros}</span>
                                                            </c:if>
                                                            <c:if test="#{seguimientoAccion.totalOtros >0}">
                                                                <a data-toggle="collapse" data-parent="#accordion" href="#collapse3">Otros Documentos 
                                                                    <span class="badge" style="background-color: #398439"> #{seguimientoAccion.totalOtros}</span>
                                                                </a>
                                                            </c:if>
                                                        </h4>
                                                    </div>
                                                    <div id="collapse3" class="panel-collapse collapse">
                                                        <div class="panel-body">                                               
                                                            <table class="table table-striped table-responsive-sm">
                                                                <thead>
                                                                    <tr>
                                                                        <th width="30%">Titulo</th>
                                                                        <th width="60%">Adjunto</th>
                                                                        <th width="20%"></th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody style="font-size: 11px">
                                                                    <c:forEach items="#{seguimientoAccion.mapAdjuntos}" var="adjunto">
                                                                        <c:if test="#{adjunto.value.tipoDeAdjunto =='DOCUMENTO'}">
                                                                            <tr>
                                                                                <td>
                                                                                    #{adjunto.value.titulo}
                                                                                </td>
                                                                                <td>
                                                                                    <a href="/datos#{adjunto.value.ubicacion}" target="blank" >Ver Archivo</a>
                                                                                </td>
                                                                                <td>
                                                                                    <div class="btn-group">
                                                                                        <h:commandLink action="#{seguimientoAccion.quitarAdjunto(adjunto.key)}" class="btn btn-danger" value="Eliminar Adjunto" onclick="if (!confirm('Seguro que desea quitar este adjunto? Se eliminara inmediatamente de la accion.'))
                                                                                                    return false">
                                                                                            <span class="glyphicon glyphicon-trash"> </span>
                                                                                            <f:ajax render="panel_lista_adjuntos"  onevent="indicador"/>
                                                                                        </h:commandLink>
                                                                                    </div>
                                                                                </td>                                                                    
                                                                            </tr>
                                                                        </c:if>
                                                                    </c:forEach>
                                                                </tbody>                                            
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </c:otherwise>
                                    </c:choose>
                                </h:panelGroup>
                            </div>
                        </div>

                        <h:panelGroup id="panel_mensajes_desestimar">
                            <div class="form-group-sm">
                                <h:message for="btn_desestimar_accion" class="msj_error"/>
                                <h:message for="btn_restaurar_accion" class="msj_error"/>
                            </div>
                        </h:panelGroup>
                        <div class="row">                    
                            <div class='col-sm-6' >
                                <h:link id="cerrar_accion" class="btn btn-default" style="width: 99%" value="Cerrar" outcome="ListarAcciones.xhtml?tipo=#{seguimientoAccion.tipoDeAccion}" />
                            </div>
                            <c:if test="#{sesionUsuario.usuarioLogueado.permisoUsuario == 'ADMINISTRADOR'}">
                                <c:choose>
                                    <c:when test="#{seguimientoAccion.accionSeleccionada.estadoDeAccion != 'CERRADA' and 
                                                    seguimientoAccion.accionSeleccionada.estadoDeAccion != 'DESESTIMADA'}">
                                        <div class='col-sm-6' >
                                            <h:commandLink class="btn btn-danger" style="width: 99%" p:data-toggle="modal" p:data-target="#modal_desestimar"
                                                           value="Desestimar">
                                                <f:ajax delay="100" render="modal_desestimar" />
                                            </h:commandLink> 
                                        </div>
                                    </c:when>
                                    <c:otherwise>
                                        <div class='col-sm-6' >
                                            <h:commandButton id="btn_restaurar_accion" class="btn btn-danger" style="width: 99%" value="Restaurar" onclick="if (!confirm('Seguro que va a restaurar esta accion? Se eliminaran todos los comentarios relacionados.'))
                                                        return false" >
                                                <f:ajax event="click" listener="#{seguimientoAccion.restarurarAccion()}" onevent="indicador" render="panel_mensajes"/>
                                            </h:commandButton>
                                        </div>
                                    </c:otherwise>
                                </c:choose>                        
                            </c:if>
                        </div>

                        <div id="modal_desestimar" class="modal fade" style="padding-top: 15%;" role="dialog">
                            <div class="modal-dialog">
                                <h:panelGroup id="panel_modal">
                                    <!-- Modal content-->
                                    <div class="modal-content">
                                        <div class="modal-header" style="background-color: gray; color: white;">
                                            <h4 class="modal-title">Observaciones</h4>
                                        </div>
                                        <div class="modal-body">
                                            <div class="form-group">
                                                <div class="col-sm-12">
                                                    <!-- Actividades -->
                                                    <div class="panel panel-primary">
                                                        <div class="panel-body">
                                                            <div class="form-group">
                                                                <strong><label for="observaciones_desestimada">Observaciones</label></strong>
                                                                <h:inputTextarea id="observaciones_desestimadas" class="form-control" value="#{seguimientoAccion.observacionesDesestimada}" 
                                                                                 required="true" requiredMessage="Se debe ingresar el motivo" p:placeholder="Observaciones/ Motivos" >
                                                                    <f:ajax execute="@this" event="change" render="panel_modal" />
                                                                </h:inputTextarea>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                        <div class="modal-footer">
                                            <div class="row">
                                                <div class="col-sm-6" >
                                                    <h:commandButton id="btn_desestimar_accion" class="btn btn-danger" style="width: 99%" value="Desestimar" onclick="if (!confirm('Seguro que va a desestimar esta accion? Se eliminarán todas las alertas relacionadas.'))
                                                                return false" >
                                                        <f:ajax event="click" listener="#{seguimientoAccion.desestimarAccion()}" onevent="indicador" render="panel_mensajes"/>
                                                    </h:commandButton>                                           
                                                </div>
                                                <div class="col-sm-6">
                                                    <h:commandButton class="btn btn-default" style="width: 99%;" p:data-dismiss="modal"  value="Cancelar">
                                                        <f:ajax render="panel_modal panel_mensajes_modal" />
                                                    </h:commandButton>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </h:panelGroup>
                            </div>
                        </div>

                        <!-- Modal Nuevo Archivo Adjunto -->
                        <div id="modal_nuevo_adjunto" class="modal fade" style="padding-top: 15%;" role="dialog">
                            <div class="modal-dialog">
                                <h:panelGroup id="panel_modal_adjunto">
                                    <!-- Modal content-->
                                    <div class="modal-content">
                                        <div class="modal-header" style="background-color: gray; color: white;">
                                            <h4 class="modal-title">Agregar Nuevo Archivo Adjunto</h4>
                                        </div>
                                        <div class="modal-body">
                                            <div class="form-group">
                                                <strong><label for="titulo_adjunto">Titulo:</label></strong>
                                                <h:inputText id="titulo_adjunto" class="form-control" p:placeholder="Titulo que describe el adjunto." value="#{seguimientoAccion.tituloAdjunto}">
                                                    <f:ajax execute="@this"  onevent="indicador"/>
                                                    <f:ajax render="panel_modal_adjunto" />
                                                </h:inputText>
                                            </div>
                                            <div class="form-group">
                                                <c:if test="#{not empty seguimientoAccion.tituloAdjunto}">
                                                    <div class="form-group">
                                                        <h:inputFile id="input-adjunto"  value="#{seguimientoAccion.archivoAdjunto}" class="btn btn-primary" p:accept="image/png, image/gif, image/jpeg, application/pdf, video/mp4">
                                                            <f:ajax event="change" listener="#{seguimientoAccion.setArchivoAdjunto(seguimientoAccion.archivoAdjunto)}" />
                                                            <f:ajax event="change" listener="#{seguimientoAccion.agregarAdjunto()}" render="form_segumiento_accion:panel_lista_adjuntos form_segumiento_accion:panel_modal_adjunto mensaje-error" onevent="indicador"/>
                                                        </h:inputFile>
                                                        <h:message id="mensaje-error" for="input-adjunto" class="msj_error"/>
                                                    </div>
                                                </c:if>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <h:commandButton  class="btn btn-default" style="width: 99%;" p:data-dismiss="modal" value="Cerrar" >
                                                <f:ajax render="panel_modal_adjunto panel_lista_adjuntos" />
                                            </h:commandButton>
                                        </div>
                                    </div>
                                </h:panelGroup>
                            </div>
                        </div>
                    </h:form>
                </div>
            </c:if>
        </c:if>
    </ui:define>
</ui:composition>


