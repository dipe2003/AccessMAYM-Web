<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="../../index.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"          
                xmlns:f="http://xmlns.jcp.org/jsf/core"                    
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"                
                xmlns:p="http://xmlns.jcp.org/jsf/passthrough">
    <ui:define name="page_content">
        <script>
            $(document).ready(function llenarGraficos() {
                var ctx = $("#chartestado");
                var chartestado = new Chart(ctx , {
                    type:'bar',
                    data: {
                        labels: ['Cerradas', 'Pendientes', 'Desestimadas', 'En Proceso Implemetacion' , 'En Proceso Verificacion'],
                        datasets: [{
                                label:'Total',
                                data:[#{graficosIndex.accionesCerradas}, #{graficosIndex.accionesPendientes}, #{graficosIndex.accionesDesestimadas}, #{graficosIndex.accionesProcesoImp}, #{graficosIndex.accionesProcesoVerif}],
                                backgroundColor:['green', 
                                    'red', 
                                    'black',
                                    'chocolate',
                                    'yellow'
                                ],
                                borderWidth: 1
                            }]
                    },
                    options: {
                        scales: {
                            yAxes: [{
                                    ticks: {
                                        beginAtZero:true
                                    }
                                }]
                        }
                        
                    }                         
                }); 
                var ctxTipo = $("#chartTipos");
                var chartTipos = new Chart(ctxTipo , {
                    type:'pie',
                    data: {
                        labels: ['Correctivas', 'Mejoras', 'Preventivas'],
                        datasets: [{
                                data:[#{graficosIndex.accionesCorrectivas}, #{graficosIndex.accionesMejora}, #{graficosIndex.accionesPreventivas}],
                                backgroundColor:[
                                    'rgba(255, 87, 51,0.2)', 
                                    'rgba(124, 144, 197, 0.2)',
                                    'rgba(255, 210, 101, 0.2)'
                                ],
                                borderWidth: 1,
                                borderColor: [
                                    'rgba(255, 99, 132, 1)',
                                    'rgba(54, 162, 235, 1)',
                                    'rgba(255, 206, 86, 1)'
                                ]
                            }]
                    }                        
                }); 
               
                var ctx = $("#chartProcesos");
                var chartProcesos = new Chart(ctx , {
                    type:'bar',
                    data: {
                        labels: ${graficosIndex.nombresProcesos},
                        datasets: [{
                                label:'Total',
                                data: ${graficosIndex.totalesPorProceso},
                                borderWidth: 1
                            }]
                    },
                    options: {
                        scales: {
                            yAxes: [{
                                    ticks: {
                                        beginAtZero:true
                                    }
                                }]
                        }
                        
                    } 
                }); 
               
            });
        </script>
        
        <h:form id="graficos_filtros">
            <!-- FILTROS -->
            <div class="container-fluid">            
                <div class="panel panel-info">
                    <div class="panel-heading">Filtrar</div>
                    <div class="panel-body">
                        <div class="table-responsive-sm">
                            <h:panelGroup id="panel_filtros">
                                <div class="row">
                                    <div class="col-md-4">
                                        <!-- FECHA DESDE -->
                                        <h:inputText id="fecha_inicial" class="form-control calendario" value="#{graficosIndex.strFechaInicial}" >
                                            <f:ajax execute="@this" event="change"  />
                                        </h:inputText>
                                    </div>
                                    <div class="col-md-4">
                                        <h:inputText id="fecha_final" class="form-control calendario" value="#{graficosIndex.strFechaFinal}" >
                                            <f:ajax execute="@this" event="change"  />
                                        </h:inputText>
                                    </div>
                                    <div class="col-md-4">
                                        <!-- BOTON FILTRAR -->
                                        <div class="col-sm-6">
                                            <h:commandButton class="btn btn-primary" value="Filtrar" action="#{graficosIndex.filtrarPorFecha()}" >
                                                <f:ajax event="click" onevent="indicador llenarGraficos" 
                                                        render="form_graficos_index graficos_filtros" />
                                            </h:commandButton>
                                        </div>
                                        <div class="col-sm-6">
                                            <h:commandButton class="btn btn-primary" value="Reset" action="#{graficosIndex.resetFechas()}" >
                                                <f:ajax event="click" onevent="indicador llenarGraficos" 
                                                        render="form_graficos_index graficos_filtros" />
                                            </h:commandButton>
                                        </div>
                                    </div>
                                </div>
                            </h:panelGroup>
                        </div>
                    </div>
                </div>
            </div>
        </h:form>
        
        <div class="container-fluid" style="padding: 1%">
            <h:form id="form_graficos_index">
                <div class="table-responsive-sm">
                    <div class="row">                    
                        <div class="col-sm-4">
                            <fieldset><legend>Total de Acciones</legend>
                                <div style="width:27vw">
                                    <canvas id="chartTipos"  ></canvas>   
                                </div>                            
                            </fieldset>
                        </div>
                        <div class="col-sm-8">
                            <fieldset><legend>Estado de Acciones</legend>
                                <div style="width:55vw">
                                    <canvas id="chartestado"  ></canvas>
                                </div>                            
                            </fieldset>
                        </div>
                    </div>
                    
                    <div class="row">                    
                        <div class="col-sm-12">
                            <fieldset><legend>Total de Acciones por Proceso</legend>
                                <div style="width:90vw">
                                    <canvas id="chartProcesos"  ></canvas>   
                                </div>                            
                            </fieldset>
                        </div>
                        
                    </div>
                </div>
            </h:form>
        </div>
    </ui:define>
</ui:composition>


